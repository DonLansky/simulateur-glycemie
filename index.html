<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulateur Glycémie</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        .disclaimer {
            background: #f8f9fa;
            border-left: 4px solid #dc3545;
            font-size: 0.9rem;
            border-radius: 4px;
            max-width: 600px;
            margin: 0 auto 2rem;
            padding: 1rem;
        }
        .card {
            max-width: 600px;
            margin: 0 auto;
            border-radius: 10px;
        }
        #resultContainer {
            max-width: 600px;
            margin: 20px auto;
        }
        .advice-list {
            list-style-type: none;
            padding-left: 0;
        }
        .advice-list li {
            padding: 5px 0;
        }
        .bi-arrow-right-short {
            color: #0d6efd;
            margin-right: 8px;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container py-5">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h3><i class="bi bi-droplet-half"></i> Simulateur Glycémie</h3>
            </div>
            <div class="card-body">
                <form id="glycemieForm">
                    <div class="mb-3">
                        <label class="form-label">Profil utilisateur</label>
                        <select class="form-select" id="profil" required>
                            <option value="" disabled selected>Sélectionnez</option>
                            <option value="jeune_actif">Jeune Actif (18-35 ans)</option>
                            <option value="adulte">Adulte (35-55 ans)</option>
                            <option value="senior">Senior (55+ ans)</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Fréquence cardiaque (BPM)</label>
                        <input type="number" class="form-control" id="bpm" required min="40" max="200" placeholder="40-200">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Saturation O₂ (SpO2)</label>
                        <input type="number" class="form-control" id="spo2" required min="70" max="100" placeholder="70-100%">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Temps depuis repas</label>
                        <select class="form-select" id="jeune" required>
                            <option value="" disabled selected>Sélectionnez</option>
                            <option value="0.5">Moins de 1h</option>
                            <option value="2">1-3h</option>
                            <option value="4">3-5h</option>
                            <option value="6">5-8h</option>
                            <option value="8">+8h (à jeun)</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-calculator"></i> Calculer
                    </button>
                </form>
            </div>
        </div>

        <div id="resultContainer" class="d-none">
            <div class="card shadow mt-4">
                <div class="card-header bg-success text-white">
                    <h3><i class="bi bi-clipboard2-pulse"></i> Résultat</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-6">
                            <p class="h5">mmol/L:</p>
                            <p class="h3 text-primary" id="resultValueMmol">0.0</p>
                        </div>
                        <div class="col-6">
                            <p class="h5">mg/dL:</p>
                            <p class="h3 text-primary" id="resultValueMg">0.0</p>
                        </div>
                    </div>
                    <p class="mt-3">Profil: <span id="profilUsed"></span></p>
                    <div id="interpretation" class="mt-3"></div>
                    <button onclick="resetForm()" class="btn btn-secondary mt-3 w-100">
                        <i class="bi bi-arrow-repeat"></i> Recommencer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Coefficients ajustés
        const coefficients = {
            'jeune_actif': [0.018, -0.012, 0.04, 4.3],
            'adulte': [0.022, -0.01, 0.05, 4.8],
            'senior': [0.025, -0.008, 0.06, 5.0]
        };

        function getInterpretation(glycemie) {
            const mgValue = (glycemie * 18).toFixed(1);
            const mmolValue = glycemie.toFixed(1);
            
            if (glycemie < 3.9) return {
                level: 'danger',
                message: 'Hypoglycémie possible',
                details: `${mmolValue} mmol/L | ${mgValue} mg/dL`,
                recommendations: [
                    'Consommer 15g de sucre rapide',
                    'Contrôler après 15 minutes',
                    'Consulter si symptômes persistent'
                ]
            };
            
            if (glycemie <= 5.5) return {
                level: 'success',
                message: 'Glycémie normale',
                details: `${mmolValue} mmol/L | ${mgValue} mg/dL`,
                recommendations: [
                    'Maintenir habitudes saines',
                    'Activité physique régulière'
                ]
            };
            
            if (glycemie <= 6.9) return {
                level: 'warning',
                message: 'Glycémie élevée',
                details: `${mmolValue} mmol/L | ${mgValue} mg/dL`,
                recommendations: [
                    'Réduire les sucres rapides',
                    'Consulter un médecin'
                ]
            };
            
            return {
                level: 'danger',
                message: 'Glycémie très élevée',
                details: `${mmolValue} mmol/L | ${mgValue} mg/dL`,
                recommendations: [
                    'Consultation médicale urgente',
                    'Bilan sanguin complet'
                ]
            };
        }

        document.getElementById('glycemieForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validation des champs
            const bpm = parseFloat(document.getElementById('bpm').value);
            const spo2 = parseFloat(document.getElementById('spo2').value);
            const jeune = document.getElementById('jeune').value;
            const profil = document.getElementById('profil').value;
            
            if (!profil || !jeune) {
                alert("Veuillez remplir tous les champs");
                return;
            }
            
            const [a, b, c, d] = coefficients[profil];
            let glycemie = (a * bpm) + (b * spo2) + (c * parseFloat(jeune)) + d;
            glycemie = Math.min(glycemie, 7.2);
            
            // Affichage
            document.getElementById('resultValueMmol').textContent = glycemie.toFixed(1);
            document.getElementById('resultValueMg').textContent = (glycemie * 18).toFixed(1);
            document.getElementById('profilUsed').textContent = 
                document.getElementById('profil').options[document.getElementById('profil').selectedIndex].text;
            
            // Interprétation
            const interpretation = getInterpretation(glycemie);
            const recommendationsHtml = interpretation.recommendations.map(r => 
                `<li><i class="bi bi-arrow-right-short"></i> ${r}</li>`
            ).join('');
            
            document.getElementById('interpretation').innerHTML = `
                <div class="alert alert-${interpretation.level}">
                    <h4>${interpretation.message}</h4>
                    <p>${interpretation.details}</p>
                    <ul class="advice-list mt-2">${recommendationsHtml}</ul>
                </div>
            `;
            
            document.getElementById('resultContainer').classList.remove('d-none');
        });

        function resetForm() {
            document.getElementById('glycemieForm').reset();
            document.getElementById('resultContainer').classList.add('d-none');
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
